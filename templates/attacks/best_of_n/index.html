{% extends "base.html" %}

{% block title %}Best of N Engine{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/communication_log.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/attacks/best_of_n.css') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    
  </style>
{% endblock %}

{% block content %}
<div class="container">

  <div class="two-column-container">
    <div class="left-card cyberpunk-card"> <h2>Configuration</h2>
      <form id="best-of-n-form" method="POST"> <div class="form-group">
          <label for="initial_prompt">Initial Prompt</label>
          <textarea name="initial_prompt" id="initial_prompt" rows="4" placeholder="Enter your prompt..."></textarea>
        </div>

        <p>
          Select an endpoint below or
          <a href="{{ url_for('endpoints_bp.create_endpoint_form') }}">register a new endpoint</a>.
        </p>
        <div class="form-group">
          <label for="registered_endpoint">Registered Endpoint</label>
          <select name="registered_endpoint" id="registered_endpoint">
            <option value="">--Select Endpoint--</option>
            {% for ep in endpoints %}
              <option value="{{ ep.id }}">{{ ep.name }} ({{ ep.hostname }}{{ ep.endpoint }})</option>
            {% endfor %}
          </select>
        </div>

        <input type="hidden" name="ep_name" id="hidden_ep_name">
        <input type="hidden" name="ep_hostname" id="hidden_ep_hostname">
        <input type="hidden" name="ep_endpoint" id="hidden_ep_endpoint">
        <input type="hidden" name="ep_payload" id="hidden_ep_payload">
        <div class="form-group">
          <label for="num_samples">Number of Permutations (N)</label>
          <input type="number" name="num_samples" id="num_samples" value="10" min="1">
        </div>

        <div class="form-group transformations-container">
          <label>Select Permutation Options:</label>

          <div class="transform-option">
            <input type="checkbox" id="rearrange_cb" name="rearrange" value="on">
            <label for="rearrange_cb" title="Randomly rearranges the middle letters of words (keeping the first and last letters intact) to introduce a subtle mix-up.">
               Rearrange Letters
            </label>
          </div>
          <div class="transform-option">
            <input type="checkbox" id="capitalization_cb" name="capitalization" value="on">
            <label for="capitalization_cb" title="Randomly toggles the case of letters to mix up uppercase and lowercase letters.">
               Random Capitalization
            </label>
          </div>
          <div class="transform-option">
             <input type="checkbox" id="substitute_cb" name="substitute" value="on">
             <label for="substitute_cb" title="Substitutes a random letter with another random letter to create minor letter differences.">
                Substitute Letter
             </label>
          </div>
          <div class="transform-option">
             <input type="checkbox" id="typo_cb" name="typo" value="on">
             <label for="typo_cb" title="Simulates a common typing error by replacing a letter with one of its adjacent keys on a QWERTY keyboard.">
                Simulate Common Typo
             </label>
          </div>
        </div>
        <input type="hidden" name="ordered_transformations" id="ordered_transformations">

        <button type="submit" class="neon-hover">ðŸš€ Run Best of N</button>
      </form>
    </div>

    <div class="right-card content-card cyberpunk-card"> <h2>Endpoint Details</h2>
      <div id="endpoint_details">
         <p class="blink">Select an endpoint to view details...</p>
         <div class="form-group" style="display: none;"> <label for="ep_name_input">Name:</label>
           <input type="text" id="ep_name_input" class="endpoint-input">
         </div>
         <div class="form-group" style="display: none;"> <label for="ep_hostname_input">Hostname:</label>
           <input type="text" id="ep_hostname_input" class="endpoint-input">
         </div>
         <div class="form-group" style="display: none;"> <label for="ep_endpoint_input">Endpoint Path:</label>
           <input type="text" id="ep_endpoint_input" class="endpoint-input">
         </div>
         <div class="form-group" style="display: none;"> <label for="ep_payload_input">Payload Template:</label>
           <textarea id="ep_payload_input" class="endpoint-input" rows="10"></textarea> </div>
      </div>
    </div>
  </div>

  <h2>Communication Log</h2>
  {% include 'partials/_comm_log.html' %} <div id="loading-indicator">
      <div id="loading-status-text">Processing...</div>
      <div class="spinner"></div>
  </div>

</div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/attacks/best_of_n.js') }}"></script>
{% endblock %}