{% extends "base.html" %}
{% block title %}All Endpoints{% endblock %}

{% block head %}
  <!-- New list test suite styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tables.css') }}">
{% endblock %}

{% block content %}
<h1>All Endpoints</h1>

<!-- A search bar to filter endpoints by hostname or path -->
<input 
  type="text" 
  id="searchEndpoint" 
  placeholder="Filter by hostname or endpoint..."
>

<!-- A table listing endpoints -->
<table id="endpointsTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Hostname</th>
      <th>Path</th>
      <th>Timestamp</th>
      <th>Payload</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for ep in endpoints %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ ep.hostname }}</td>
        <td>{{ ep.endpoint }}</td>
        <td>
          {% if ep.timestamp %}
            {{ ep.timestamp }}
          {% else %}
            --
          {% endif %}
        </td>
        <td>
          {% if ep.http_payload %}
            {{ ep.http_payload|truncate(50) }}
          {% else %}
            --
          {% endif %}
        </td>
        <td>
          <!-- Expand/collapse headers or link to a detail page -->
          <button 
            type="button" 
            class="view-headers-btn"
            data-endpoint-id="{{ ep.id }}"
          >
            View Headers
          </button>
          <a href="{{ url_for('endpoints_bp.view_endpoint_details', endpoint_id=ep.id) }}">View</a>
        </td>
      </tr>

      <!-- Hidden row for headers, expand on button click -->
      <tr class="headers-row">
        <td colspan="6">
          <div class="headers-container">
            {% if ep.headers %}
              <ul>
                {% for hdr in ep.headers %}
                  <li>{{ hdr.key }}: {{ hdr.value }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <p>No headers available.</p>
            {% endif %}
          </div>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/listEndpoints.js') }}"></script>
{% endblock %}
