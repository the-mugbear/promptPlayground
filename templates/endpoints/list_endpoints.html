{% extends "base.html" %}
{% block title %}Endpoints{% endblock %}

{% block content %}
<h1>All Endpoints</h1>
<a href="{{ url_for('endpoints_bp.create_endpoint_form') }}">Create New Endpoint</a>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul>
      {% for category, message in messages %}
        <li>{{ category }}: {{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

{% if endpoints %}
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Hostname</th>
        <th>Endpoint Path</th>
        <th>Payload</th>
        <th>Headers</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for ep in endpoints %}
        <tr>
          <td>{{ ep.id }}</td>
          <td>{{ ep.hostname }}</td>
          <td>{{ ep.endpoint }}</td>
          <td>{{ ep.http_payload }}</td>
          <td>
            <ul>
              {% for hdr in ep.headers %}
                <li>{{ hdr.key }}: {{ hdr.value }}</li>
              {% endfor %}
            </ul>
          </td>
          <td>
            <a href="{{ url_for('endpoints_bp.view_endpoint_details', endpoint_id=ep.id) }}">View</a> |
            <form action="{{ url_for('endpoints_bp.test_endpoint', endpoint_id=ep.id) }}" method="GET" style="display:inline;">
              <button type="submit">Test</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No endpoints configured.</p>
{% endif %}
{% endblock %}
