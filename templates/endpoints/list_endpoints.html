{% extends "base.html" %}
{% block title %}All Endpoints{% endblock %}

{% block head %}
  <!-- New list test suite styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tables.css') }}">
{% endblock %}

{% block content %}
<h1>All Endpoints</h1>

<!-- A search bar to filter endpoints by hostname or path -->
<input 
  type="text" 
  id="searchEndpoint" 
  placeholder="Filter by hostname or endpoint..."
  class="search-bar"
>

<!-- A table listing endpoints -->
<table id="endpointsTable">
  <thead>
    <tr>
      <th>Label</th>
      <th>Hostname</th>
      <th>Path</th>
      <th>Timestamp</th>
      <th>Payload</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for ep in endpoints %}
      <tr>
        <td>{{ ep.name }}</td>
        <td>{{ ep.hostname }}</td>
        <td>{{ ep.endpoint }}</td>
        <td>
          {% if ep.timestamp %}
            {{ ep.timestamp }}
          {% else %}
            --
          {% endif %}
        </td>
        <td>
          {% if ep.http_payload %}
            {{ ep.http_payload|truncate(50) }}
          {% else %}
            --
          {% endif %}
        </td>
        <td>
            <!-- Expand/collapse headers or link to a detail page -->
            <button 
              type="button" 
              class="view-headers-btn"
              data-endpoint-id="{{ ep.id }}"
            >
              View Headers
            </button>

            <button
              type="button"
              class="details-page-btn">
              <a href="{{ url_for('endpoints_bp.view_endpoint_details', endpoint_id=ep.id) }}">Details Page</a>
            </button>

            <!-- Form to delete an endpoint -->
            <form action="{{ url_for('endpoints_bp.delete_endpoint', endpoint_id=ep.id) }}" method="POST" style="display:inline;">
              <button 
                type="submit" 
                class="delete-endpoint-btn"
                onclick="return confirm('Are you sure you want to delete this endpoint?');"
              >
                Delete
              </button>
            </form>
        </td>
      </tr>

      <!-- Hidden row for headers, expand on button click -->
      <tr class="headers-row">
        <td colspan="6">
          <div class="headers-container">
            {% if ep.headers %}
              <ul>
                {% for hdr in ep.headers %}
                  <li>{{ hdr.key }}: {{ hdr.value }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <p>No headers available.</p>
            {% endif %}
          </div>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/listEndpoints.js') }}"></script>
{% endblock %}
