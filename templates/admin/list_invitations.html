{% extends 'base.html' %}

{# Local macro definition #}
{% macro render_pagination(pagination, endpoint) %}
  {# ... pagination macro code ... #}
{% endmacro %}

{% block title %}Manage Invitations - Admin{% endblock %}

{% block content %}
{# 1. Apply card styling to main container #}
<div class="content-card mt-4"> {# Or use a custom class styled like report-section #}

    {# 2. Animated Heading #}
    <h1 class="cyberpunk-flicker">Manage Invitations</h1>

    <p class="mb-4">
        {# 5. Neon Hover Button #}
        <a href="{{ url_for('admin_bp.create_invitation') }}" class="btn btn-success btn-sm neon-hover">[+] Create New Invitation</a>
    </p>

    {% if invitations %}
    {# 3. Enhanced Table Container #}
    <div class="themed-table-wrapper"> {# Style this class like .chart-container or .report-section #}
        <h3 class="cyberpunk-flicker">Invitation Codes</h3> {# Optional themed sub-heading #}
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>Code</th>
                        <th>Email Restriction</th>
                        <th>Assign Role</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Expires</th>
                        <th>Notes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for inv in invitations %}
                    <tr class="{{ 'table-secondary' if inv.is_used else ('table-warning' if not inv.is_valid() else '') }}">
                        <td>
                            <input type="text" readonly value="{{ inv.code }}" id="invite-code-{{ inv.id }}" size="18" style="background: transparent; border: none; color: inherit; cursor: default; padding: 0;">
                            <button class="btn btn-outline-secondary btn-sm py-0 neon-hover" onclick="copyCode('invite-code-{{ inv.id }}')" title="Copy Code">Copy</button>
                        </td>
                        <td>{{ inv.email or 'Any' }}</td>
                        <td>{{ inv.role_to_assign }}</td>
                        <td>
                            {# 4. Use specific status classes for potential text-shadow/glow #}
                            {% if inv.is_used %}
                                <span class="badge status-skipped">Used</span> {# Example: using skipped style for used #}
                            {% elif not inv.is_valid() %}
                                <span class="badge status-failed">Expired</span> {# Use report's status-failed style #}
                            {% else %}
                                <span class="badge status-passed">Valid</span> {# Use report's status-passed style #}
                            {% endif %}
                        </td>
                        <td>{{ inv.created_at.strftime('%Y-%m-%d %H:%M') if inv.created_at else '-'}}</td>
                        <td>{{ inv.expires_at.strftime('%Y-%m-%d %H:%M') if inv.expires_at else 'Never' }}</td>
                        <td>{{ inv.notes or '-' }}</td>
                        <td>
                            {# Add themed action buttons/icons here later #}
                            -
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {# Pagination - Apply neon-hover via JS or specific CSS if desired #}
        {{ render_pagination(pagination, 'admin_bp.list_invitations') }}
    </div> {# End themed-table-wrapper #}

    {% else %}
    <p>No invitations found.</p>
    {% endif %}

</div> {# End content-card #}

{# 6 & 7: Loading Indicator Placeholder (control visibility with JS) #}
<div id="action-loader" style="display: none;">
    {# Choose your loader type, e.g.: #}
    <div class="typing-loader">Processing...</div>
    {# Or <div class="terminal-loader processing"></div> #}
</div>

{# Updated script for copy feedback #}
<script>
function copyCode(elementId) {
    const input = document.getElementById(elementId);
    const button = input.nextElementSibling;
    const originalText = button.textContent;

    input.select();
    input.setSelectionRange(0, 99999);

    try {
        navigator.clipboard.writeText(input.value);

        // Enhanced Feedback
        button.textContent = 'Copied!';
        button.classList.add('btn-success'); // Use themed success state
        button.classList.add('cyberpunk-flicker'); // Add flicker effect

        // Optional: Show flash message (requires Flask backend setup)
        // showFlashMessage('Code copied successfully!', 'success');

        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('btn-success');
            button.classList.remove('cyberpunk-flicker'); // Remove flicker
        }, 1500);

    } catch (err) {
        console.error('Failed to copy code: ', err);
        button.textContent = 'Error!';
        button.classList.add('btn-danger'); // Use themed error state
         button.classList.add('cyberpunk-flicker');

        // Optional: Show flash message for error
        // showFlashMessage('Failed to copy code.', 'error');

         setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('btn-danger');
            button.classList.remove('cyberpunk-flicker');
        }, 2000);
    }
    window.getSelection().removeAllRanges();
}
</script>

{% endblock %}

{% block scripts %}
    {{ super() }}
    {# Include JS for loaders if needed, e.g.: #}
    {# <script src="{{ url_for('static', filename='js/styling/matrix.js') }}"></script> #}
{% endblock %}